# ‚úÖ CHECKLIST DE DESPLIEGUE - BASE DE DATOS KSAMATI

## üìä RESUMEN R√ÅPIDO

**Base de Datos:** `ksamati_proyectos`  
**Tablas:** 8 tablas  
**Procedimientos:** 2 procedimientos almacenados  
**Triggers:** 5 triggers autom√°ticos  
**Estado:** ‚úÖ LISTO PARA PRODUCCI√ìN

---

## üéØ DECISI√ìN: ¬øCREAR O NO LA BASE DE DATOS?

### ‚úÖ **S√ç, CR√âALA SI:**
- ‚úì Necesitas gestionar proyectos con c√°lculos autom√°ticos
- ‚úì Requieres auditor√≠a completa de cambios
- ‚úì Quieres sistema de cotizaciones inteligente
- ‚úì Necesitas gesti√≥n de documentos y archivos
- ‚úì Buscas escalabilidad y performance optimizado

### ‚ùå **NO LA CREES SI:**
- ‚úó Solo necesitas un prototipo temporal
- ‚úó No tienes acceso a MySQL
- ‚úó Prefieres soluciones sin servidor (Firebase, etc)

---

## üöÄ GU√çA R√ÅPIDA DE INSTALACI√ìN (3 MINUTOS)

### **Opci√≥n 1: Autom√°tica (Recomendada)**

```bash
# 1. Clonar/navegar al proyecto
cd project-acabados

# 2. Crear archivo .env
# Copia y pega esto en un nuevo archivo .env:
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=TU_PASSWORD_AQUI
DB_NAME=ksamati_proyectos
DB_PORT=3306
PORT=5000
NODE_ENV=development

# 3. Instalar dependencias (si no lo has hecho)
npm install

# 4. Instalar base de datos completa
npm run setup-db-complete

# 5. Verificar instalaci√≥n
npm run verify-db
```

### **Opci√≥n 2: Manual (Si prefieres control total)**

```sql
-- 1. Conectar a MySQL
mysql -u root -p

-- 2. Crear base de datos
CREATE DATABASE ksamati_proyectos CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 3. Salir de MySQL y ejecutar schema
exit;

-- 4. Cargar schema completo
mysql -u root -p ksamati_proyectos < server/database/ksamati_complete_schema.sql

-- 5. Verificar
mysql -u root -p ksamati_proyectos -e "SHOW TABLES;"
```

---

## üìã CHECKLIST PASO A PASO

### **FASE 1: PREPARACI√ìN** ‚è±Ô∏è 2 minutos

- [ ] MySQL instalado y corriendo
- [ ] Credenciales de acceso disponibles
- [ ] Node.js instalado (v14+)
- [ ] Proyecto descargado/clonado
- [ ] Terminal/CMD abierto en carpeta del proyecto

### **FASE 2: CONFIGURACI√ìN** ‚è±Ô∏è 1 minuto

- [ ] Archivo `.env` creado en ra√≠z del proyecto
- [ ] Variable `DB_HOST` configurada
- [ ] Variable `DB_USER` configurada  
- [ ] Variable `DB_PASSWORD` configurada
- [ ] Variable `DB_NAME` configurada (ksamati_proyectos)
- [ ] Variable `DB_PORT` configurada (3306)

### **FASE 3: INSTALACI√ìN** ‚è±Ô∏è 30 segundos

- [ ] Ejecutado `npm install` (si es necesario)
- [ ] Ejecutado `npm run setup-db-complete`
- [ ] Sin errores en consola
- [ ] Mensaje "‚úÖ BD completa instalada" visible

### **FASE 4: VERIFICACI√ìN** ‚è±Ô∏è 1 minuto

- [ ] Ejecutado `npm run verify-db`
- [ ] 8 tablas confirmadas
- [ ] 2 procedimientos confirmados
- [ ] 5 triggers confirmados
- [ ] 3 proyectos de ejemplo creados
- [ ] 3 ventas de ejemplo creadas

### **FASE 5: PRUEBA** ‚è±Ô∏è 2 minutos

- [ ] Servidor iniciado (`npm run dev`)
- [ ] API respondiendo en puerto 5000
- [ ] Endpoint `/api/health` accesible
- [ ] Frontend cargando correctamente
- [ ] Datos de ejemplo visibles

---

## üóÑÔ∏è ESTRUCTURA CREADA

Al completar la instalaci√≥n tendr√°s:

### **Tablas (8)**
1. ‚úÖ `proyectos` - Gesti√≥n de proyectos principal
2. ‚úÖ `proyecto_detalles` - Informaci√≥n extendida
3. ‚úÖ `proyecto_categorias` - 24 categor√≠as por proyecto
4. ‚úÖ `proyecto_documentos` - Documentos asociados
5. ‚úÖ `archivos_adjuntos` - PDFs e im√°genes
6. ‚úÖ `ventas` - Gesti√≥n de ventas
7. ‚úÖ `venta_cotizadores` - Cotizadores especializados
8. ‚úÖ `proyecto_cambios` - Auditor√≠a completa

### **Procedimientos Almacenados (2)**
1. ‚úÖ `CalcularCamposAutomaticosProyecto()` - C√°lculos de proyectos
2. ‚úÖ `CalcularCamposAutomaticosVenta()` - C√°lculos de ventas

### **Triggers (5)**
1. ‚úÖ `tr_proyectos_update` - Actualiza al modificar proyecto
2. ‚úÖ `tr_categorias_update` - Actualiza al modificar categor√≠a
3. ‚úÖ `tr_categorias_insert` - Actualiza al insertar categor√≠a
4. ‚úÖ `tr_ventas_update` - Actualiza al modificar venta
5. ‚úÖ `tr_cotizadores_update` - Actualiza al modificar cotizador

### **Datos de Ejemplo (6 registros)**
- ‚úÖ 3 proyectos demo con datos reales
- ‚úÖ 3 ventas demo con cotizadores
- ‚úÖ 72 categor√≠as (24 por proyecto)
- ‚úÖ 15 documentos asociados

---

## üéõÔ∏è COMANDOS DISPONIBLES

```bash
# Instalaci√≥n
npm run setup-db              # Instalaci√≥n interactiva
npm run setup-db-complete     # Instalaci√≥n autom√°tica completa
npm run setup-db-production   # Instalaci√≥n para producci√≥n

# Verificaci√≥n
npm run verify-db             # Verificaci√≥n completa
npm run check-db              # Verificaci√≥n r√°pida

# Desarrollo
npm run dev                   # Servidor + Frontend
npm run server                # Solo servidor
npm run client                # Solo frontend
```

---

## üè≠ DESPLIEGUE EN PRODUCCI√ìN

### **Para cPanel / Hosting Compartido**

1. **Acceder a phpMyAdmin**
2. **Crear BD:** `ksamati_proyectos` (utf8mb4_unicode_ci)
3. **Importar:** `server/database/ksamati_complete_schema.sql`
4. **Configurar `.env`** con credenciales del hosting
5. **Subir proyecto** v√≠a FTP o Git

### **Para VPS / Servidor Dedicado**

```bash
# 1. Conectar al servidor
ssh usuario@tu-servidor.com

# 2. Instalar MySQL
sudo apt install mysql-server

# 3. Configurar seguridad
sudo mysql_secure_installation

# 4. Crear usuario y BD
sudo mysql
CREATE USER 'ksamati'@'localhost' IDENTIFIED BY 'password_seguro';
CREATE DATABASE ksamati_proyectos CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
GRANT ALL ON ksamati_proyectos.* TO 'ksamati'@'localhost';
FLUSH PRIVILEGES;
exit;

# 5. Clonar proyecto
git clone [url-del-repo]
cd project-acabados

# 6. Instalar dependencias
npm install

# 7. Configurar .env
nano .env
# (pegar configuraci√≥n)

# 8. Instalar BD
npm run setup-db-complete

# 9. Iniciar con PM2
npm install -g pm2
pm2 start server/index.js --name ksamati
pm2 save
pm2 startup
```

### **Para Docker**

```bash
# 1. Verificar docker-compose.yml existe
ls docker-compose.yml

# 2. Construir y levantar
docker-compose up -d

# 3. Verificar
docker-compose ps
docker-compose logs mysql
```

---

## ‚ö†Ô∏è PROBLEMAS COMUNES Y SOLUCIONES

### **Error: "Cannot connect to MySQL"**
```bash
# Verificar si MySQL est√° corriendo
sudo systemctl status mysql

# Si est√° parado, iniciar
sudo systemctl start mysql

# En Windows
net start MySQL80
```

### **Error: "Access denied"**
```sql
-- Resetear password de root
ALTER USER 'root'@'localhost' IDENTIFIED BY 'nueva_password';
FLUSH PRIVILEGES;
```

### **Error: "Database already exists"**
```sql
-- Opci√≥n 1: Usar la existente
USE ksamati_proyectos;

-- Opci√≥n 2: Eliminar y recrear
DROP DATABASE ksamati_proyectos;
-- Luego ejecutar npm run setup-db-complete
```

### **Error: "Table already exists"**
```sql
-- Verificar qu√© tablas existen
SHOW TABLES;

-- Si est√°n todas, solo verificar
npm run verify-db

-- Si faltan tablas, reinstalar
npm run setup-db-complete
```

### **No hay datos de ejemplo**
```sql
-- Verificar si existen
SELECT COUNT(*) FROM proyectos;

-- Si es 0, insertar manualmente ejecutando las l√≠neas 446-558 de:
-- server/database/ksamati_complete_schema.sql
```

---

## üîê SEGURIDAD EN PRODUCCI√ìN

### **Checklist de Seguridad**

- [ ] Contrase√±a fuerte (min 12 caracteres)
- [ ] Usuario espec√≠fico (NO usar root)
- [ ] Firewall configurado (solo puerto 3306 si es necesario)
- [ ] SSL/TLS habilitado
- [ ] Backups autom√°ticos configurados
- [ ] `.env` en `.gitignore`
- [ ] Permisos de archivos correctos (chmod 600 .env)
- [ ] Logs de auditor√≠a activados

### **Crear Backup Autom√°tico**

```bash
# Crear script de backup
nano /home/tu-usuario/backup-ksamati.sh

# Contenido del script:
#!/bin/bash
FECHA=$(date +%Y%m%d_%H%M%S)
mysqldump -u ksamati -p'password' ksamati_proyectos > /backups/ksamati_$FECHA.sql
# Eliminar backups de m√°s de 30 d√≠as
find /backups/ -name "ksamati_*.sql" -mtime +30 -delete

# Hacer ejecutable
chmod +x /home/tu-usuario/backup-ksamati.sh

# Agregar a crontab (diario a las 2 AM)
crontab -e
0 2 * * * /home/tu-usuario/backup-ksamati.sh
```

---

## üìä ESTAD√çSTICAS ESPERADAS

Despu√©s de la instalaci√≥n completa:

| M√©trica | Valor Esperado |
|---------|----------------|
| **Tablas creadas** | 8 |
| **Procedimientos** | 2 |
| **Triggers** | 5 |
| **Proyectos ejemplo** | 3 |
| **Ventas ejemplo** | 3 |
| **Categor√≠as** | 72 (24√ó3) |
| **Documentos** | 15 (5√ó3) |
| **Tama√±o BD** | ~5-10 MB |

---

## ‚úÖ VERIFICACI√ìN FINAL

### **Test R√°pido (30 segundos)**

```bash
# 1. Verificar BD
npm run check-db
# Debe mostrar: "‚úÖ Base de datos OK"

# 2. Iniciar servidor
npm run server
# Debe mostrar: "üöÄ Servidor KSAMATI ejecut√°ndose en puerto 5000"

# 3. Probar API
# Abrir en navegador: http://localhost:5000/api/health
# Debe mostrar JSON con status: "OK" y database: "Connected"

# 4. Probar frontend
npm run client
# Debe abrir en: http://localhost:3000
```

### **Test Completo (2 minutos)**

```sql
-- 1. Conectar a MySQL
mysql -u root -p ksamati_proyectos

-- 2. Verificar tablas
SHOW TABLES;
-- Debe mostrar 8 tablas

-- 3. Verificar datos
SELECT COUNT(*) FROM proyectos;
-- Debe mostrar: 3

-- 4. Verificar procedimientos
SHOW PROCEDURE STATUS WHERE Db = 'ksamati_proyectos';
-- Debe mostrar: 2 procedimientos

-- 5. Probar c√°lculo autom√°tico
CALL CalcularCamposAutomaticosProyecto(1);
SELECT balance_proyecto FROM proyectos WHERE id = 1;
-- Debe mostrar un valor calculado

-- 6. Verificar triggers
SHOW TRIGGERS;
-- Debe mostrar: 5 triggers
```

---

## üéâ ¬°LISTO PARA USAR!

Si completaste todos los checkboxes y las verificaciones pasan, tu base de datos est√°:

‚úÖ **Instalada correctamente**  
‚úÖ **Optimizada y funcionando**  
‚úÖ **Con datos de ejemplo**  
‚úÖ **Lista para producci√≥n**  
‚úÖ **Con c√°lculos autom√°ticos activos**  
‚úÖ **Con auditor√≠a completa**  

### **Pr√≥ximos Pasos:**

1. ‚ú® Iniciar servidor: `npm run dev`
2. üöÄ Probar en navegador: `http://localhost:3000`
3. üìä Explorar datos de ejemplo
4. üé® Personalizar seg√∫n necesidades
5. üè≠ Desplegar en producci√≥n cuando est√© listo

---

## üìö RECURSOS ADICIONALES

- **Documentaci√≥n completa:** `DIAGRAMA-BASE-DE-DATOS-KSAMATI.md`
- **Schema completo:** `server/database/ksamati_complete_schema.sql`
- **Gu√≠a de despliegue:** `DEPLOYMENT-GUIDE-CPANEL.md`
- **README principal:** `README.md`

---

## üìû ¬øNECESITAS AYUDA?

1. ‚úÖ Revisa el diagrama completo en `DIAGRAMA-BASE-DE-DATOS-KSAMATI.md`
2. ‚úÖ Ejecuta `npm run verify-db` para diagn√≥stico autom√°tico
3. ‚úÖ Verifica logs de MySQL: `sudo tail -f /var/log/mysql/error.log`
4. ‚úÖ Consulta la secci√≥n de Troubleshooting en este documento

---

**Creado:** Octubre 2025  
**Versi√≥n:** 1.0  
**Estado:** ‚úÖ Production Ready

**¬°√âxito con tu despliegue! üöÄ**


